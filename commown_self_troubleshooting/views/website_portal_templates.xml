<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="web_layout" inherit_id="web.layout">
      <xpath expr="//link[@rel='shortcut icon']" position="after">
        <style>
          @media (max-width: 768px) {
            #wrap>div.container.mb64 {
              display: flex;
              flex-direction: column-reverse;
            }
          }
        </style>
      </xpath>
    </template>


    <template id="self-troubleshoot-portal-access" inherit_id="portal.portal_layout">

      <xpath expr="//a[@href='/my/account']/ancestor::div[1]" position="after">

        <t t-set="contracts" t-value="env['contract.contract'].sudo().search([('partner_id', '=', env.user.partner_id.id), ('date_end', '=', False), ('contract_template_id', '!=', False)])"/>
        <t t-set="contract_types" t-value="set(c.contract_template_id.name.split(u'/', 1)[0] for c in contracts)"/>

        <div t-if="contract_types" class="mt-4">

          <h4>Self troubleshooting</h4>
          <hr class="mt-1 mb-0"/>

          <div class="mt-3" t-if="'FP2' in contract_types">
            <h5>Fairphone 2</h5>
            <div class="list-group">
              <a target="_blank" class="list-group-item" t-attf-href="/page/self-troubleshoot-fp2-camera">
                Ma caméra principale fonctionne mal ou plus du tout
              </a>
              <a target="_blank" class="list-group-item" t-attf-href="/page/self-troubleshoot-fp2-micro">
                Mon interlocuteur ne m'entend pas
              </a>
              <a target="_blank" class="list-group-item" t-attf-href="/page/self-troubleshoot-fp2-battery">
                  Ma batterie se décharge rapidement
              </a>
            </div>
          </div>

          <div class="mt-3" t-if="'FP3' in contract_types or 'FP3+' in contract_types">
            <h5>Fairphone 3</h5>
            <div class="list-group">
              <a target="_blank" class="list-group-item" t-attf-href="/page/self-troubleshoot-fp3-display">
                Mon écran ne fonctionne plus
              </a>
              <a target="_blank" class="list-group-item" t-attf-href="/page/self-troubleshoot-fp3-screen">
                Mon écran (ou sa protection) est fissuré
              </a>
            </div>
          </div>

          <div class="mt-3" t-if="'GS' in contract_types">
            <h5>Gerrard Street</h5>
            <div class="list-group">
              <a target="_blank" class="list-group-item" t-attf-href="/page/self-troubleshoot-gs-day">
                Problème de son avec mon casque DAY
              </a>
            </div>
          </div>

        </div>

      </xpath>

    </template>


    <record id="self-troubleshoot-web-layout" model="ir.ui.view">
      <field name="name">Web layout for self troubleshooting pages</field>
      <field name="type">qweb</field>
      <field name="key">commown-self-troubleshoot.web-layout</field>
      <field name="arch" type="xml">

        <t name="Web layout for self troubleshooting pages"
          t-name="commown-self-troubleshoot.web-layout">&lt;!DOCTYPE html&gt;
        <html t-att="html_data or {}">
          <head>
            <meta charset="utf-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1"/>

            <title t-esc="title or 'Odoo'"/>
            <link type="image/x-icon" rel="shortcut icon" t-att-href="x_icon or '/web/static/src/img/favicon.ico'"/>

            <style>
              .btn-toolbar .btn-group.sw-btn-group-extra {float: right;}
            </style>

            <script type="text/javascript">
              var odoo = {
              csrf_token: "<t t-esc="request.csrf_token(None)"/>",
              };
            </script>

            <link rel="stylesheet" type="text/css"
                  href="/commown_self_troubleshooting/static/lib/bootstrap_3.4.1/bootstrap.min.css"/>
            <link rel="stylesheet" type="text/css"
                  href="/commown_self_troubleshooting/static/lib/smartwizard/css/smart_wizard.min.css"/>
            <link rel="stylesheet" type="text/css"
                  href="/commown_self_troubleshooting/static/lib/smartwizard/css/smart_wizard_theme_arrows.min.css"/>
            <link rel="stylesheet" type="text/css"
                  href="/commown_self_troubleshooting/static/lib/fontawesome-5.13.0/css/all.min.css"/>

            <script src="/commown_self_troubleshooting/static/lib/jquery-3.3.1.min.js"></script>
            <script src="/commown_self_troubleshooting/static/lib/1000hz-bootstrap-validator_0.11.5/validator.min.js"></script>
            <script src="/commown_self_troubleshooting/static/lib/smartwizard/js/jquery.smartWizard.js"></script>
            <script src="/commown_self_troubleshooting/static/src/setup_wizard.js"></script>

            <t t-raw="head or ''"/>

          </head>

          <body t-att-class="body_classname">
            <t t-raw="0"/>
          </body>

        </html>
        </t>

      </field>
    </record>

</odoo>
