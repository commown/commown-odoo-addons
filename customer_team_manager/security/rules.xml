<odoo noupdate="1">

  <record model="ir.rule" id="team_customer_rule">
    <field name="name">Customer Team Manager: see only own teams</field>
    <field name="model_id" ref="model_customer_team_manager_team"/>
    <field name="groups" eval="[(4, ref('customer_team_manager.group_customer_admin'))]"/>
    <field name="domain_force">[('company', '=', user.commercial_partner_id.id)]</field>
  </record>

  <record model="ir.rule" id="employee_customer_rule">
    <field name="name">Customer Team Manager: see only own employees</field>
    <field name="model_id" ref="model_customer_team_manager_employee"/>
    <field name="groups" eval="[(4, ref('customer_team_manager.group_customer_admin'))]"/>
    <field name="domain_force">[('company', '=', user.commercial_partner_id.id)]</field>
  </record>

  <record model="ir.rule" id="account_invoice_rule_customer_accounting">
    <field name="name">Portal: see company invoices if accounting customer</field>
    <field name="model_id" ref="account.model_account_invoice"/>
    <field name="domain_force">
      [('partner_id','child_of',[user.commercial_partner_id.id])]
    </field>
    <field name="groups" eval="[(6, 0, [ref('group_customer_accounting')])]"/>
    <field name="perm_read" eval="1"/>
    <field name="perm_write" eval="1"/>
    <field name="perm_create" eval="1"/>
    <field name="perm_unlink" eval="1"/>
  </record>

  <record model="ir.rule" id="account_invoice_line_rule_customer_accounting">
    <field name="name">Portal: see company invoice lines if accounting customer</field>
    <field name="model_id" ref="account.model_account_invoice_line"/>
    <field name="domain_force">
      [('partner_id','child_of',[user.commercial_partner_id.id])]
    </field>
    <field name="groups" eval="[(6, 0, [ref('group_customer_accounting')])]"/>
    <field name="perm_read" eval="1"/>
    <field name="perm_write" eval="1"/>
    <field name="perm_create" eval="1"/>
    <field name="perm_unlink" eval="1"/>
  </record>

  <!-- Existing rules overrides: restrict existing ir_rules with groups -->

  <function name="write" model="ir.model.data">
    <function name="search" model="ir.model.data">
      <value eval="[('module', '=', 'account'), ('name', 'in', ('account_invoice_rule_portal', 'account_invoice_line_rule_portal'))] "/>
    </function>
    <value eval="{'noupdate': False}"/>
  </function>

  <record model="ir.rule" id="account.account_invoice_rule_portal">
    <field name="name">Portal: see direcly followed invoices (from customer_team_manager)</field>
    <field name="model_id" ref="account.model_account_invoice"/>
    <field name="domain_force">[('message_partner_ids', "=", user.partner_id.id)]</field>
  </record>

  <record model="ir.rule" id="account.account_invoice_line_rule_portal">
    <field name="name">Portal: see direcly followed invoice lines (from customer_team_manager)</field>
    <field name="model_id" ref="account.model_account_invoice_line"/>
    <field name="domain_force">[('invoice_id.message_partner_ids', "=", user.partner_id.id)]</field>
  </record>

  <function name="write" model="ir.model.data">
    <function name="search" model="ir.model.data">
      <value eval="[('module', '=', 'account'), ('name', 'in', ('account_invoice_rule_portal', 'account_invoice_line_rule_portal'))] "/>
    </function>
    <value eval="{'noupdate': True}"/>
  </function>

</odoo>
