<?xml version="1.0"?>
<odoo>

  <record id="action_add_to_support_groups" model="ir.actions.server">
    <field name="name">[commown] Add buyer to product's support groups</field>
    <field name="model_id" ref="sale.model_sale_order"/>
    <field name="sequence">5</field>
    <field name="state">code</field>
    <field name="code">
for group in record.mapped("order_line.product_id.product_tmpl_id.support_group_ids"):
    group.add_users(record.partner_id.user_ids)
    </field>
  </record>

  <record id="order_sent" model="base.automation">
    <field name="name">[Commown] Sale done</field>
    <field name="model_id" ref="sale.model_sale_order"/>
    <field name="sequence">1</field>
    <field name="state">multi</field>
    <field name="trigger">on_write</field>
    <field name="filter_pre_domain">['|', ('state', '=', 'draft'), ('state', '=', 'sent')]</field>
    <field name="filter_domain">[('state', '=', 'sale')]</field>
    <field name="child_ids" eval="[(6,0,[ref('commown.action_add_to_support_groups')])]"/>
  </record>

</odoo>
