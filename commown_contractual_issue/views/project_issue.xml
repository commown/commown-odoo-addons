<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <record model="ir.ui.view" id="project_issue_form_view">
    <field name="name">contractual.project.issue.form.view</field>
    <field name="model">project.issue</field>
    <field name="inherit_id" ref="project_issue.project_issue_form_view"/>
    <field name="arch" type="xml">
      <xpath expr="//sheet//field[@name='partner_id']/ancestor::group[1]" position="after">
        <group name="contract">
          <field name="contract_id"
                 context="{'form_view_ref': 'contract.account_analytic_account_recurring_form_form'}"
                 attrs="{'required': [('require_contract', '=', True)], 'invisible': [('require_contract', '=', False)]}"
                 options="{'no_create': True}"
                 domain="[('partner_id', 'child_of', commercial_partner_id)]"/>
          <field name="commercial_partner_id" invisible="True"/>
          <field name="require_contract" invisible="True"/>
        </group>
      </xpath>
    </field>
  </record>

</odoo>
